// Generated by CoffeeScript 1.6.3
$(function() {
  var baseMaps, graphic, map, midnight, onLocationError, onLocationFound;
  if ($('body').data('page') === 'CheckinsNew') {
    graphic = L.tileLayer('http://{s}.tile.stamen.com/toner/{z}/{x}/{y}.jpg', {
      attribution: "<a href='http://stamen.com'>Stamen Design</a> <a href='http://creativecommons.org/licenses/by/3.0'>CC-BY-SA</a>"
    });
    midnight = L.tileLayer("http://{s}.tile.cloudmade.com/8fe4ccbb4940415d9475cc21bf41ea53/999/256/{z}/{x}/{y}.png", {
      attribution: '2011 CloudMade'
    });
    map = new L.map('map', {
      layers: [graphic]
    });
    baseMaps = {
      "Day View": graphic,
      "Night View": midnight
    };
    L.control.layers(baseMaps).addTo(map);
    map.locate({
      setView: true,
      maxZoom: 16
    });
    onLocationFound = function(e) {
      var radius;
      radius = e.accuracy / 2;
      $('#checkin_latitude').val(e.latitude);
      $('#checkin_longitude').val(e.longitude);
      return L.marker(e.latlng, {
        draggable: true
      }).addTo(map).bindPopup("You are within " + radius + " meters of this point").openPopup();
    };
    map.on("locationfound", onLocationFound);
    onLocationError = function(e) {
      return alert(e.message);
    };
    return map.on("locationerror", onLocationError);
  }
});
